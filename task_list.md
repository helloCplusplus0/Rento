# Rento 开发任务列表

> 基于"小步快跑"开发理念的详细任务规划，确保项目稳步推进

## 📋 任务分类说明

- **🏗️ 基础架构**: 项目搭建和核心配置
- **🎨 UI/UX**: 界面设计和用户体验
- **⚙️ 功能开发**: 核心业务功能实现
- **🔧 优化完善**: 性能优化和功能完善
- **🧪 测试部署**: 测试和部署相关

---

## 第一阶段：MVP 开发 (预计 4 周)

### Week 1: 项目初始化和基础架构

#### 🏗️ 项目搭建
- [✅] **T1.1** 初始化 Next.js 14 项目
  - 创建项目结构
  - 配置 TypeScript
  - 设置 App Router
  - 预计时间: 4小时

- [✅] **T1.2** 配置开发环境
  - 安装和配置 Tailwind CSS
  - 集成 shadcn/ui 组件库
  - 配置 ESLint 和 Prettier
  - 设置 VS Code 工作区配置
  - 预计时间: 6小时

- [✅] **T1.3** 数据库设计和配置
  - 安装和配置 Prisma ORM
  - 设计数据库模式 (Building, Room, Renter, Contract, Bill)
  - 基于UI分析文档 (docs/ui_analysis.md) 设计数据结构
  - 实现楼栋-楼层-房间的层级关系
  - 配置房间状态管理 (vacant/occupied/overdue/maintenance)
  - 设计合同生命周期管理
  - 实现账单状态跟踪 (pending/paid/overdue/completed)
  - 创建初始迁移文件
  - 配置 SQLite 数据库
  - 预计时间: 10小时

- [✅] **T1.4** 基础组件库搭建
  - 基于UI分析文档设计组件系统
  - 创建状态标识组件 (房间状态、账单状态、合同状态)
  - 实现卡片式布局组件 (RoomCard, BillCard, ContractCard)
  - 设置色彩系统 (成功/警告/错误/信息状态色)
  - 创建统计面板组件 (DashboardStats)
  - 实现楼层房间网格布局组件
  - 创建移动端友好的表单组件
  - 设置触摸友好的交互组件 (最小44px点击区域)
  - 预计时间: 12小时

#### 🎨 基础 UI 框架
- [✅] **T1.5** 响应式布局系统
  - 实现移动端优先的布局
  - 创建底部导航栏
  - 设置断点和响应式规则
  - 预计时间: 8小时

### Week 2: 主页面和导航系统

#### 🎨 主页面开发
- [✅] **T2.1** 主页面布局
  - 创建 Dashboard 页面结构 (基于main.jpg设计)
  - 实现顶部财务统计区域 (待收/待付金额)
  - 添加搜索栏 (房源、合同搜索)
  - 预计时间: 6小时

- [✅] **T2.2** 数据统计卡片
  - 实现待收/待付逾期金额展示
  - 创建今日/30日收付款统计
  - 添加数据加载状态和空状态
  - 实现统计数据实时更新
  - 预计时间: 8小时

- [✅] **T2.3** 功能模块网格
  - 实现核心4个功能入口 (账单、房源、合同、添加)
  - 移除非核心功能 (数据分析、设备管理、钱包等)
  - 添加功能图标和导航链接
  - 设置响应式网格布局 (2x2网格)
  - 预计时间: 4小时

#### ⚙️ 导航系统
- [✅] **T2.4** 底部导航栏
  - 实现 5 个主要 Tab (工作台、房源、添加、合同、消息)
  - 添加导航状态管理
  - 设置路由跳转逻辑
  - 预计时间: 8小时

- [✅] **T2.5** 页面路由配置
  - 配置 App Router 路由结构
  - 实现页面间导航
  - 添加路由守卫 (后期)
  - 预计时间: 4小时

### Week 3: 房间管理功能

#### ⚙️ 房间管理核心功能
- [✅] **T3.1** 房间列表页面
  - 实现楼栋-楼层-房间层级展示 (基于room_list.jpg)
  - 创建房间网格布局 (按楼层分组)
  - 实现房间状态可视化 (绿/蓝/红/灰色标识)
  - 添加房间状态筛选 (空房/在租/逾期/维护)
  - 显示租客姓名和逾期天数
  - 预计时间: 12小时

- [✅] **T3.2** 房间详情页面
  - 设计房间详情界面
  - 显示房间基本信息 (房号、面积、租金)
  - 显示当前租客和合同信息
  - 添加房间状态管理功能
  - 实现房间编辑和删除功能
  - 预计时间: 10小时

- [✅] **T3.3** 添加房间功能
  - 创建楼栋管理 (新增/选择楼栋)
  - 实现楼层和房间批量添加
  - 设置房间类型 (合租/整租/单间)
  - 配置房间基本信息表单
  - 实现表单验证和数据库操作
  - 预计时间: 12小时

#### 🔧 数据操作
- [✅] **T3.4** 房间 CRUD 操作
  - 实现楼栋-楼层-房间的关联查询
  - 添加房间状态批量更新 API
  - 实现房间搜索和筛选 API
  - 添加数据验证中间件
  - 处理房间删除的级联操作
  - 预计时间: 10小时

### Week 4: 账单管理功能

#### ⚙️ 账单管理核心功能
- [✅] **T4.1** 账单列表页面
  - 创建账单列表组件
  - 实现分类和筛选功能
  - 添加状态标识 (已付/未付/逾期)
  - 预计时间: 10小时

- [✅] **T4.2** 账单详情页面
  - 设计账单详情界面
  - 显示账单完整信息
  - 添加支付状态更新功能
  - 预计时间: 8小时

- [✅] **T4.3** 创建账单功能
  - 创建账单录入表单
  - 关联房间和合同信息
  - 实现自动计算功能
  - 预计时间: 10小时

#### 🔧 账单统计
- [✅] **T4.4** 账单统计功能
  - 实现收支统计计算
  - 创建统计图表组件
  - 添加时间范围筛选
  - 预计时间: 8小时

---

## 第二阶段：功能完善 (预计 6 周)

### Week 5-6: 租客和合同管理

#### ⚙️ 租客管理
- [✅] **T5.1** 租客信息管理
  - 创建租客列表和详情页面
  - 实现租客信息 CRUD 操作
  - 添加租客搜索功能
  - 预计时间: 16小时

- [✅] **T5.2** 合同管理系统
  - 创建合同列表和详情页面
  - 实现合同状态管理
  - 添加合同到期提醒
  - 预计时间: 20小时

- [✅] **T5.3** 合同CRUD功能完善
  - 实现合同创建功能 (表单设计、数据验证、自动账单生成)
  - 完善合同编辑功能 (基本信息修改、状态管理)
  - 实现合同续约功能 (续约表单、新合同生成、旧合同处理)
  - 集成工作台到期提醒 (真实数据展示、快捷操作)
  - 预计时间: 16小时

#### ⚙️ 水电表管理系统
- [✅] **T5.4** 水电表基础架构
  - 扩展数据库模型支持多类型仪表 (电表、冷水表、热水表、燃气表)
  - 设计仪表配置表 (Meter) 和抄表记录表 (MeterReading)
  - 实现房间-仪表关联关系 (一对多，支持同类型多仪表)
  - 创建仪表类型枚举和业务规则
  - 实现仪表基础CRUD查询函数
  - 预计时间: 12小时

- [✅] **T5.5** 仪表配置管理
  - 在房间管理中集成仪表配置功能
  - 创建仪表添加/编辑表单 (支持自定义名称、位置、单价)
  - 实现仪表列表展示和管理界面
  - 支持仪表启用/禁用状态管理
  - 添加仪表配置验证和业务规则检查
  - 预计时间: 14小时

- [✅] **T5.6** 抄表管理功能
  - 创建抄表录入界面 (支持批量和单个抄表)
  - 实现抄表历史查询和展示
  - 添加用量异常检测和提醒 (负数、异常高用量)
  - 支持抄表数据的编辑和修正
  - 实现抄表周期管理和提醒
  - 预计时间: 16小时

- [✅] **T5.7** 水电费账单集成
  - 扩展自动账单生成系统支持水电费
  - 实现抄表完成后自动生成UTILITIES类型账单
  - 集成水电费计算逻辑 (用量 × 单价)
  - 支持水电费账单的详细明细展示
  - 实现水电费账单与抄表记录的关联
  - 预计时间: 10小时

#### 🔧 账单系统优化和修复
- [✅] **T5.8** 账单聚合逻辑修复
  - 修复账单聚合策略执行失败问题
  - 完善groupReadingsByContract函数数据验证
  - 增强selectAggregationStrategy逻辑判断
  - 修复generateAggregatedUtilityBill执行异常
  - 确保正确生成AGGREGATED类型账单
  - 预计时间: 4小时

- [✅] **T5.9** 账单明细系统完善
  - 修复账单明细API的500错误问题
  - 实现账单明细数据的多源回退机制
  - 完善bill_details表数据创建逻辑
  - 增强账单详情页面的兼容性处理
  - 优化账单明细组件的错误处理
  - 预计时间: 3小时

- [✅] **T5.10** 抄表状态同步机制
  - 修复抄表记录状态未更新问题
  - 实现账单生成后自动更新抄表状态为BILLED
  - 完善抄表历史页面状态显示逻辑
  - 添加抄表状态同步的数据一致性检查
  - 实现状态同步失败的自动修复机制
  - 预计时间: 2小时

- [✅] **T5.11** 事务管理和数据一致性
  - 引入Prisma事务管理确保数据一致性
  - 实现账单生成的原子性操作
  - 添加数据一致性验证和修复工具
  - 完善错误回滚和恢复机制
  - 实现批量操作的事务保护
  - 预计时间: 6小时

- [✅] **T5.12** 错误处理和监控优化
  - 增强账单生成过程的错误日志记录
  - 实现账单生成失败的智能回退机制
  - 添加账单系统健康状态监控
  - 完善用户友好的错误提示和反馈
  - 实现账单生成异常的自动告警
  - 预计时间: 4小时

- [✅] **T5.13** 账单系统性能优化
  - 优化批量抄表的账单生成性能
  - 实现账单查询的数据库索引优化
  - 添加账单列表的分页和缓存机制
  - 优化账单明细的关联查询性能
  - 实现账单统计的计算缓存
  - 预计时间: 5小时

#### 🎨 用户体验优化 (后置到第三阶段)
- [X] **T6.1** 搜索和筛选功能 (已后置)
  - 实现全局搜索功能
  - 添加高级筛选选项
  - 优化搜索性能
  - 预计时间: 12小时
  - **后置原因**: 属于体验优化功能，应在核心功能稳定后实施

- [X] **T6.2** 数据可视化 (已后置)
  - 集成图表库 (Chart.js 或 Recharts)
  - 创建收支趋势图表
  - 实现数据导出功能
  - 预计时间: 16小时
  - **后置原因**: 需要基于稳定的数据源，避免因数据源问题导致的调试困扰

### Week 6-7: 核心功能稳定性验证和性能优化

#### 🔧 性能优化和稳定性验证
- [✅] **T8.1** 性能优化 (提前执行)
  - 实现虚拟滚动 (长列表)
  - 添加图片懒加载
  - 优化数据库查询
  - 实现前端缓存策略
  - 优化API响应时间
  - 预计时间: 16小时 (增加4小时)

- [X] **T8.2** PWA 功能集成
  - 配置 Service Worker
  - 实现离线缓存
  - 添加安装提示
  - 优化移动端体验
  - 预计时间: 16小时

#### 🧪 核心功能验证
- [✅] **T8.3** 核心业务流程验证 (新增)
  - 验证房间管理完整流程 (添加→租赁→退租)
  - 验证账单生成和支付流程
  - 验证水电表抄表和计费流程
  - 验证合同生命周期管理
  - 测试数据一致性和完整性
  - 预计时间: 12小时

- [✅] **T8.4** 生产环境准备 (新增)
  - 配置生产环境数据库
  - 实现数据备份和恢复机制
  - 添加系统监控和日志
  - 配置错误追踪和告警
  - 性能基准测试
  - 预计时间: 14小时

### Week 8-9: 测试和质量保证

#### 🧪 测试和质量保证
- [ ] **T9.1** 单元测试
  - 编写核心功能单元测试
  - 配置测试环境 (Jest + Testing Library)
  - 实现测试覆盖率报告
  - 预计时间: 20小时

- [ ] **T9.2** 集成测试
  - 编写 API 集成测试
  - 测试数据库操作
  - 验证业务流程
  - 预计时间: 16小时

#### 🔧 最终优化
- [ ] **T10.1** 用户体验优化
  - 优化加载速度
  - 改进错误处理
  - 完善用户反馈
  - 预计时间: 12小时

- [ ] **T10.2** 文档和部署准备
  - 完善 API 文档
  - 创建用户使用指南
  - 准备部署配置
  - 预计时间: 8小时

---

## 第三阶段：功能完善和扩展 (预计 6 周)

### Week 10-11: 高级功能开发

#### ⚙️ 高级功能开发 (从第二阶段后置)
- [ ] **T11.1** 提醒和通知系统 (原T7.1)
  - 实现到期提醒功能
  - 添加逾期账单提醒
  - 创建通知中心
  - 预计时间: 16小时

- [ ] **T11.2** 数据导入导出 (原T7.2)
  - 实现 Excel 数据导入
  - 添加数据导出功能
  - 创建数据备份机制
  - 预计时间: 12小时

#### 🎨 用户体验完善 (从第二阶段后置)
- [ ] **T11.3** 搜索和筛选功能 (原T6.1)
  - 实现全局搜索功能
  - 添加高级筛选选项
  - 优化搜索性能
  - 预计时间: 12小时

- [ ] **T11.4** 数据可视化 (原T6.2)
  - 集成图表库 (Chart.js 或 Recharts)
  - 创建收支趋势图表
  - 实现数据导出功能
  - 预计时间: 16小时

### Week 12-13: 多用户支持准备

#### 🏗️ 认证架构准备
- [ ] **T12.1** NextAuth.js 集成 (原T11.1)
  - 配置 NextAuth.js
  - 实现邮箱/密码登录
  - 添加第三方登录 (Google, GitHub)
  - 预计时间: 16小时

- [ ] **T12.2** 用户管理系统 (原T11.2)
  - 创建用户注册/登录页面
  - 实现用户资料管理
  - 添加密码重置功能
  - 预计时间: 20小时

---

## 第四阶段：多用户支持 (预计 6 周)

### Week 14-15: 权限和多租户

#### ⚙️ 权限管理
- [ ] **T13.1** 角色权限系统 (原T12.1)
  - 设计权限模型 (管理员/普通用户)
  - 实现基于角色的访问控制
  - 添加权限验证中间件
  - 预计时间: 20小时

#### 🏗️ 多租户支持
- [ ] **T13.2** 数据隔离 (原T13.1)
  - 重构数据库模式支持多租户
  - 实现租户数据隔离
  - 添加租户管理功能
  - 预计时间: 24小时

- [ ] **T13.3** 租户管理 (原T13.2)
  - 创建租户注册流程
  - 实现租户配置管理
  - 添加计费和订阅功能
  - 预计时间: 20小时

### Week 16-17: 云端同步

#### ⚙️ 数据同步
- [ ] **T14.1** 数据库迁移 (原T15.1)
  - 从 SQLite 迁移到 PostgreSQL
  - 实现数据迁移脚本
  - 配置生产环境数据库
  - 预计时间: 16小时

- [ ] **T14.2** 云端同步功能 (原T15.2)
  - 实现数据同步机制
  - 添加冲突解决策略
  - 创建同步状态监控
  - 预计时间: 24小时

### Week 18-19: 高级报表和部署

#### 📊 高级报表
- [ ] **T15.1** 高级报表系统 (原T17.1)
  - 创建自定义报表生成器
  - 实现数据分析功能
  - 添加报表导出和分享
  - 预计时间: 20小时

#### 🚀 生产部署
- [ ] **T15.2** 生产环境部署 (原T18.1)
  - 配置 Docker 容器化
  - 设置 CI/CD 流水线
  - 配置监控和日志系统
  - 预计时间: 16小时

- [ ] **T15.3** 性能监控和优化 (原T18.2)
  - 集成性能监控工具
  - 实现错误追踪
  - 优化生产环境性能
  - 预计时间: 12小时

---

## 📊 任务统计 (更新后)

### 第一阶段 (MVP)
- **总任务数**: 18 个
- **预计总时间**: 172 小时
- **平均每周**: 43 小时
- **状态**: ✅ 已完成

### 第二阶段 (核心功能稳定化) - **重新规划**
- **总任务数**: 12 个 (原22个，调整后减少10个)
- **预计总时间**: 188 小时 (原316小时，减少128小时)
- **平均每周**: 47 小时 (4周完成)
- **重点**: 性能优化、稳定性验证、测试和生产准备

### 第三阶段 (功能完善和扩展) - **新增阶段**
- **总任务数**: 8 个 (从第二阶段后置的任务)
- **预计总时间**: 112 小时
- **平均每周**: 37 小时 (3周完成)
- **重点**: 用户体验优化、高级功能、多用户准备

### 第四阶段 (多用户支持) - **重新编号**
- **总任务数**: 9 个 (原12个)
- **预计总时间**: 248 小时 (原320小时)
- **平均每周**: 41 小时 (6周完成)
- **重点**: 认证、权限、多租户、云端同步

### 项目总计 (调整后)
- **总任务数**: 47 个 (原52个，减少5个)
- **预计总时间**: 720 小时 (原808小时，减少88小时)
- **开发周期**: 18 周 (原20周，缩短2周)

---

## 🎯 里程碑检查点 (更新后)

### MVP 里程碑 (第 4 周末) ✅
- [x] 基础功能完整可用
- [x] 移动端适配完成
- [x] 核心数据流程打通
- [x] 基础 UI/UX 体验良好

### 核心功能稳定化里程碑 (第 8 周末) - **新增重点里程碑**
- [ ] 所有核心功能经过完整验证
- [ ] 性能优化达到生产标准
- [ ] 系统稳定性和数据一致性验证通过
- [ ] 生产环境部署准备完成
- [ ] 测试覆盖率 > 80%

### 功能完善里程碑 (第 11 周末) - **调整后**
- [ ] 用户体验优化完成
- [ ] 高级功能稳定运行
- [ ] 多用户系统准备就绪
- [ ] 数据可视化和分析功能完善

### 多用户系统里程碑 (第 17 周末) - **最终里程碑**
- [ ] 多用户系统稳定运行
- [ ] 云端同步功能正常
- [ ] 生产环境部署成功
- [ ] 监控和运维体系完善

---

## 📋 调整说明

### 🔄 主要调整内容

1. **任务重新排序**: 
   - T6.1-T6.2 (搜索筛选、数据可视化) → 后置到第三阶段
   - T7.1-T7.2 (通知系统、数据导入导出) → 后置到第三阶段
   - T8.1 (性能优化) → 提前到第二阶段第6周

2. **新增核心验证任务**:
   - T8.3: 核心业务流程验证
   - T8.4: 生产环境准备

3. **阶段重新定义**:
   - 第二阶段: 聚焦核心功能稳定性和性能优化
   - 第三阶段: 功能完善和用户体验优化
   - 第四阶段: 多用户支持和云端部署

### 🎯 调整理由

1. **优先验证核心功能**: 确保房间管理、账单系统、水电表管理等核心业务流程的稳定性
2. **性能优先**: 在功能扩展前先解决性能问题，避免后期重构成本
3. **生产就绪**: 提前准备生产环境，确保系统可以尽早投入使用
4. **体验优化后置**: 搜索筛选等体验功能在核心稳定后实施，避免数据源问题
5. **数据可视化延后**: 基于稳定的数据源开发分析功能，减少调试复杂度

---

---

## 📝 注意事项 (更新后)

1. **任务优先级**: 严格按照调整后的阶段顺序执行，优先确保核心功能稳定性
2. **性能优先**: T8.1性能优化提前执行，为后续功能扩展奠定基础
3. **验证导向**: 新增的T8.3和T8.4任务确保系统可以投入生产使用
4. **体验后置**: 搜索筛选、数据可视化等体验功能在核心稳定后实施
5. **时间估算**: 预留 20% 的缓冲时间处理意外情况
6. **代码质量**: 每个任务完成后进行代码审查
7. **测试覆盖**: 核心功能必须有对应的测试用例
8. **文档更新**: 重要功能完成后及时更新文档
9. **用户反馈**: 每个阶段完成后收集用户反馈并调整计划

---

**最后更新**: 2024年1月  
**文档版本**: v2.0 (重新规划版)  
**调整原因**: 基于核心功能稳定性优先的开发策略