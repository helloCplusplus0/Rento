# T5.6 æŠ„è¡¨ç®¡ç†åŠŸèƒ½ - è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

**ä»»åŠ¡ç¼–å·**: T5.6  
**ä»»åŠ¡åç§°**: æŠ„è¡¨ç®¡ç†åŠŸèƒ½  
**é¢„è®¡æ—¶é—´**: 16å°æ—¶  
**ä¼˜å…ˆçº§**: é«˜  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

### å­ä»»åŠ¡æ¸…å•
- [x] åˆ›å»ºæŠ„è¡¨å½•å…¥ç•Œé¢ (æ”¯æŒæ‰¹é‡å’Œå•ä¸ªæŠ„è¡¨)
- [x] å®ç°æŠ„è¡¨å†å²æŸ¥è¯¢å’Œå±•ç¤º
- [x] æ·»åŠ ç”¨é‡å¼‚å¸¸æ£€æµ‹å’Œæé†’ (è´Ÿæ•°ã€å¼‚å¸¸é«˜ç”¨é‡)
- [x] æ”¯æŒæŠ„è¡¨æ•°æ®çš„ç¼–è¾‘å’Œä¿®æ­£
- [x] å®ç°æŠ„è¡¨å‘¨æœŸç®¡ç†å’Œæé†’

## ğŸ¯ è®¾è®¡ç›®æ ‡

åŸºäº T5.4 æ°´ç”µè¡¨åŸºç¡€æ¶æ„å’Œ T5.5 ä»ªè¡¨é…ç½®ç®¡ç†å·²å®Œæˆçš„åŸºç¡€ï¼Œå®ç°å®Œæ•´çš„æŠ„è¡¨ç®¡ç†åŠŸèƒ½ï¼š

1. **æ‰¹é‡æŠ„è¡¨**: åœ¨å·¥ä½œå°æä¾›æ‰¹é‡æŠ„è¡¨å¿«æ·å…¥å£ï¼Œæ”¯æŒå¤šæˆ¿é—´å¤šä»ªè¡¨çš„æ‰¹é‡å½•å…¥
2. **å•æ¬¡æŠ„è¡¨**: åœ¨åˆåŒè¯¦æƒ…é¡µé¢æä¾›å•æ¬¡æŠ„è¡¨å…¥å£ï¼Œé’ˆå¯¹ç‰¹å®šåˆåŒè¿›è¡ŒæŠ„è¡¨
3. **å…¨å±€é…ç½®**: åœ¨è®¾ç½®é¡µé¢æä¾›æŠ„è¡¨ç›¸å…³çš„å…¨å±€é…ç½®ï¼ˆæŠ„è¡¨å‘¨æœŸã€å¼‚å¸¸é˜ˆå€¼ç­‰ï¼‰
4. **å¼‚å¸¸æ£€æµ‹**: æ™ºèƒ½æ£€æµ‹ç”¨é‡å¼‚å¸¸å¹¶æä¾›æé†’å’Œå¤„ç†å»ºè®®
5. **å†å²ç®¡ç†**: å®Œæ•´çš„æŠ„è¡¨å†å²æŸ¥è¯¢ã€ç¼–è¾‘å’Œä¿®æ­£åŠŸèƒ½

## ğŸ—ï¸ æŠ€æœ¯æ–¹æ¡ˆ

### 1. ç°çŠ¶åˆ†æ

#### 1.1 å·²æœ‰åŸºç¡€è®¾æ–½ âœ…
åŸºäºT5.4å’ŒT5.5å·²å®Œæˆçš„åŸºç¡€æ¶æ„ï¼Œå·²å…·å¤‡ï¼š
- **æ•°æ®æ¨¡å‹**: å®Œæ•´çš„Meterå’ŒMeterReadingæ•°æ®æ¨¡å‹
- **æŸ¥è¯¢å‡½æ•°**: `meterQueries`å’Œ`meterReadingQueries`å®Œæ•´çš„CRUDæ“ä½œ
- **å·¥å…·å‡½æ•°**: `meter-utils.ts`ä¸­çš„å®Œæ•´å·¥å…·å‡½æ•°åº“
- **ä¸šåŠ¡ç»„ä»¶**: ä»ªè¡¨é…ç½®å’Œç®¡ç†ç›¸å…³ç»„ä»¶
- **ç±»å‹å®šä¹‰**: å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰

#### 1.2 ç°æœ‰å…¥å£ç‚¹åˆ†æ
- **å·¥ä½œå°é¡µé¢**: `DashboardPageWithStats.tsx` - å¯æ·»åŠ æ‰¹é‡æŠ„è¡¨å¿«æ·å…¥å£
- **è®¾ç½®é¡µé¢**: `SettingsPage.tsx` - å·²æœ‰æ°´ç”µå•ä»·é…ç½®ï¼Œå¯æ‰©å±•æŠ„è¡¨ç›¸å…³è®¾ç½®
- **åˆåŒè¯¦æƒ…**: `ContractDetailPage.tsx` - å¯æ·»åŠ å•æ¬¡æŠ„è¡¨å…¥å£
- **æˆ¿é—´è¯¦æƒ…**: å·²é›†æˆä»ªè¡¨ç®¡ç†ï¼Œå¯æ‰©å±•æŠ„è¡¨åŠŸèƒ½

### 2. åŠŸèƒ½æ¶æ„è®¾è®¡

#### 2.1 æ‰¹é‡æŠ„è¡¨åŠŸèƒ½
```
BatchMeterReadingPage (æ‰¹é‡æŠ„è¡¨é¡µé¢)
â”œâ”€â”€ PageContainer (é¡µé¢å®¹å™¨)
â”œâ”€â”€ BatchReadingHeader (é¡µé¢å¤´éƒ¨)
â”‚   â”œâ”€â”€ BackButton (è¿”å›æŒ‰é’®)
â”‚   â”œâ”€â”€ PageTitle (é¡µé¢æ ‡é¢˜)
â”‚   â””â”€â”€ BatchActions (æ‰¹é‡æ“ä½œ)
â”œâ”€â”€ BatchReadingContent (ä¸»è¦å†…å®¹)
â”‚   â”œâ”€â”€ RoomSelector (æˆ¿é—´é€‰æ‹©å™¨)
â”‚   â”œâ”€â”€ MeterReadingGrid (æŠ„è¡¨ç½‘æ ¼)
â”‚   â”‚   â””â”€â”€ MeterReadingCard (æŠ„è¡¨å¡ç‰‡)
â”‚   â”œâ”€â”€ ReadingForm (æŠ„è¡¨è¡¨å•)
â”‚   â””â”€â”€ ValidationSummary (éªŒè¯æ‘˜è¦)
â””â”€â”€ SubmitActions (æäº¤æ“ä½œ)
```

#### 2.2 å•æ¬¡æŠ„è¡¨åŠŸèƒ½
```
SingleMeterReadingModal (å•æ¬¡æŠ„è¡¨å¼¹çª—)
â”œâ”€â”€ ModalHeader (å¼¹çª—å¤´éƒ¨)
â”œâ”€â”€ MeterSelector (ä»ªè¡¨é€‰æ‹©)
â”œâ”€â”€ ReadingForm (æŠ„è¡¨è¡¨å•)
â”‚   â”œâ”€â”€ PreviousReading (ä¸Šæ¬¡è¯»æ•°)
â”‚   â”œâ”€â”€ CurrentReading (æœ¬æ¬¡è¯»æ•°)
â”‚   â”œâ”€â”€ UsageCalculation (ç”¨é‡è®¡ç®—)
â”‚   â””â”€â”€ AmountCalculation (è´¹ç”¨è®¡ç®—)
â”œâ”€â”€ ValidationWarnings (éªŒè¯è­¦å‘Š)
â””â”€â”€ SubmitActions (æäº¤æ“ä½œ)
```

#### 2.3 æŠ„è¡¨å†å²åŠŸèƒ½
```
MeterReadingHistoryPage (æŠ„è¡¨å†å²é¡µé¢)
â”œâ”€â”€ PageContainer (é¡µé¢å®¹å™¨)
â”œâ”€â”€ HistoryHeader (é¡µé¢å¤´éƒ¨)
â”‚   â”œâ”€â”€ SearchBar (æœç´¢æ )
â”‚   â””â”€â”€ FilterOptions (ç­›é€‰é€‰é¡¹)
â”œâ”€â”€ HistoryContent (ä¸»è¦å†…å®¹)
â”‚   â”œâ”€â”€ ReadingList (æŠ„è¡¨åˆ—è¡¨)
â”‚   â”‚   â””â”€â”€ ReadingHistoryCard (å†å²è®°å½•å¡ç‰‡)
â”‚   â””â”€â”€ ReadingChart (ç”¨é‡è¶‹åŠ¿å›¾)
â””â”€â”€ ExportActions (å¯¼å‡ºæ“ä½œ)
```

### 3. æ ¸å¿ƒåŠŸèƒ½è®¾è®¡

#### 3.1 æŠ„è¡¨æ•°æ®å½•å…¥
```typescript
interface MeterReadingFormData {
  meterId: string
  contractId?: string
  previousReading?: number
  currentReading: number
  readingDate: Date
  period?: string
  operator?: string
  remarks?: string
}

// æŠ„è¡¨å½•å…¥æµç¨‹
1. é€‰æ‹©ä»ªè¡¨æˆ–æˆ¿é—´ âœ…
2. æ˜¾ç¤ºä¸Šæ¬¡è¯»æ•° âœ…
3. è¾“å…¥æœ¬æ¬¡è¯»æ•° âœ…
4. è‡ªåŠ¨è®¡ç®—ç”¨é‡å’Œè´¹ç”¨ âœ…
5. å¼‚å¸¸æ£€æµ‹å’Œè­¦å‘Š âœ…
6. ç¡®è®¤æäº¤ âœ…
7. ç”Ÿæˆæ°´ç”µè´¹è´¦å• âœ…
```

#### 3.2 ç”¨é‡å¼‚å¸¸æ£€æµ‹
```typescript
interface UsageAnomalyRule {
  type: 'negative' | 'high_usage' | 'zero_usage' | 'sudden_spike'
  threshold?: number
  description: string
  severity: 'warning' | 'error'
}

// å¼‚å¸¸æ£€æµ‹è§„åˆ™
const ANOMALY_RULES: UsageAnomalyRule[] = [
  {
    type: 'negative',
    description: 'æœ¬æ¬¡è¯»æ•°å°äºä¸Šæ¬¡è¯»æ•°',
    severity: 'error'
  },
  {
    type: 'high_usage',
    threshold: 3, // 3å€å¹³å‡ç”¨é‡
    description: 'ç”¨é‡å¼‚å¸¸åé«˜',
    severity: 'warning'
  },
  {
    type: 'zero_usage',
    description: 'ç”¨é‡ä¸ºé›¶',
    severity: 'warning'
  },
  {
    type: 'sudden_spike',
    threshold: 5, // 5å€ä¸Šæ¬¡ç”¨é‡
    description: 'ç”¨é‡çªç„¶æ¿€å¢',
    severity: 'warning'
  }
]
```

#### 3.3 æŠ„è¡¨å‘¨æœŸç®¡ç†
```typescript
interface ReadingCycleConfig {
  meterType: MeterType
  cycleType: 'monthly' | 'quarterly' | 'custom'
  cycleDays: number
  reminderDays: number
  autoGenerate: boolean
}

// å‘¨æœŸé…ç½®ç¤ºä¾‹
const DEFAULT_CYCLES: ReadingCycleConfig[] = [
  {
    meterType: 'ELECTRICITY',
    cycleType: 'monthly',
    cycleDays: 30,
    reminderDays: 3,
    autoGenerate: true
  },
  {
    meterType: 'COLD_WATER',
    cycleType: 'monthly',
    cycleDays: 30,
    reminderDays: 3,
    autoGenerate: true
  }
]
```

### 4. APIè·¯ç”±è®¾è®¡

#### 4.1 æŠ„è¡¨å½•å…¥API
```typescript
// POST /api/meter-readings
interface CreateMeterReadingRequest {
  readings: MeterReadingFormData[]
  validateOnly?: boolean // ä»…éªŒè¯ä¸ä¿å­˜
}

interface CreateMeterReadingResponse {
  success: boolean
  readings: MeterReading[]
  bills?: Bill[] // ç”Ÿæˆçš„è´¦å•
  warnings: ValidationWarning[]
  errors: ValidationError[]
}
```

#### 4.2 æŠ„è¡¨å†å²API
```typescript
// GET /api/meter-readings
interface MeterReadingQueryParams {
  meterId?: string
  contractId?: string
  roomId?: string
  startDate?: string
  endDate?: string
  status?: ReadingStatus
  page?: number
  limit?: number
}

// GET /api/meter-readings/[id]
// PUT /api/meter-readings/[id]
// DELETE /api/meter-readings/[id]
```

#### 4.3 å¼‚å¸¸æ£€æµ‹API
```typescript
// POST /api/meter-readings/validate
interface ValidateReadingRequest {
  meterId: string
  currentReading: number
  readingDate: Date
}

interface ValidateReadingResponse {
  isValid: boolean
  warnings: ValidationWarning[]
  errors: ValidationError[]
  suggestions: string[]
}
```

### 5. ç»„ä»¶è®¾è®¡

#### 5.1 æ‰¹é‡æŠ„è¡¨ç»„ä»¶
```typescript
// æ‰¹é‡æŠ„è¡¨é¡µé¢
interface BatchMeterReadingPageProps {
  initialRooms?: string[]
}

// æŠ„è¡¨ç½‘æ ¼ç»„ä»¶
interface MeterReadingGridProps {
  meters: MeterWithReadings[]
  readings: Record<string, MeterReadingFormData>
  onReadingChange: (meterId: string, data: MeterReadingFormData) => void
  onValidate: (meterId: string) => void
}

// æŠ„è¡¨å¡ç‰‡ç»„ä»¶
interface MeterReadingCardProps {
  meter: MeterWithReadings
  reading: MeterReadingFormData
  validation: ValidationResult
  onChange: (data: MeterReadingFormData) => void
}
```

#### 5.2 å•æ¬¡æŠ„è¡¨ç»„ä»¶
```typescript
// å•æ¬¡æŠ„è¡¨å¼¹çª—
interface SingleMeterReadingModalProps {
  contractId: string
  meterId?: string
  isOpen: boolean
  onClose: () => void
  onSuccess: (reading: MeterReading) => void
}

// æŠ„è¡¨è¡¨å•ç»„ä»¶
interface MeterReadingFormProps {
  meter: MeterWithReadings
  initialData?: Partial<MeterReadingFormData>
  onSubmit: (data: MeterReadingFormData) => void
  onValidate: (data: MeterReadingFormData) => ValidationResult
}
```

#### 5.3 æŠ„è¡¨å†å²ç»„ä»¶
```typescript
// æŠ„è¡¨å†å²é¡µé¢
interface MeterReadingHistoryPageProps {
  meterId?: string
  contractId?: string
  roomId?: string
}

// å†å²è®°å½•å¡ç‰‡
interface ReadingHistoryCardProps {
  reading: MeterReadingWithDetails
  onEdit: (reading: MeterReading) => void
  onDelete: (readingId: string) => void
}

// ç”¨é‡è¶‹åŠ¿å›¾
interface UsageTrendChartProps {
  readings: MeterReading[]
  meterType: MeterType
  timeRange: 'month' | 'quarter' | 'year'
}
```

### 6. è®¾ç½®æ‰©å±•è®¾è®¡

#### 6.1 æŠ„è¡¨ç›¸å…³è®¾ç½®
```typescript
// æ‰©å±•AppSettingsæ¥å£
interface AppSettings {
  // ... ç°æœ‰è®¾ç½®
  
  // æŠ„è¡¨è®¾ç½®
  readingCycle: 'monthly' | 'quarterly' | 'custom'
  readingReminderDays: number
  usageAnomalyThreshold: number // å¼‚å¸¸ç”¨é‡å€æ•°
  autoGenerateBills: boolean // æŠ„è¡¨åè‡ªåŠ¨ç”Ÿæˆè´¦å•
  requireReadingApproval: boolean // éœ€è¦æŠ„è¡¨å®¡æ‰¹
}
```

#### 6.2 è®¾ç½®é¡µé¢æ‰©å±•
```typescript
// æŠ„è¡¨è®¾ç½®é…ç½®
const readingSettings: SettingItemConfig[] = [
  {
    id: 'readingCycle',
    title: 'æŠ„è¡¨å‘¨æœŸ',
    description: 'é»˜è®¤çš„æŠ„è¡¨å‘¨æœŸè®¾ç½®',
    type: 'select',
    value: settings.readingCycle,
    options: [
      { label: 'æœˆåº¦æŠ„è¡¨', value: 'monthly' },
      { label: 'å­£åº¦æŠ„è¡¨', value: 'quarterly' },
      { label: 'è‡ªå®šä¹‰', value: 'custom' }
    ]
  },
  {
    id: 'readingReminderDays',
    title: 'æŠ„è¡¨æé†’å¤©æ•°',
    description: 'æŠ„è¡¨åˆ°æœŸå‰å¤šå°‘å¤©å¼€å§‹æé†’',
    type: 'input',
    value: settings.readingReminderDays,
    unit: 'å¤©',
    min: 1,
    max: 30
  },
  {
    id: 'usageAnomalyThreshold',
    title: 'å¼‚å¸¸ç”¨é‡é˜ˆå€¼',
    description: 'è¶…è¿‡å¹³å‡ç”¨é‡å¤šå°‘å€è§†ä¸ºå¼‚å¸¸',
    type: 'input',
    value: settings.usageAnomalyThreshold,
    unit: 'å€',
    min: 1.5,
    max: 10,
    step: 0.5
  },
  {
    id: 'autoGenerateBills',
    title: 'è‡ªåŠ¨ç”Ÿæˆè´¦å•',
    description: 'æŠ„è¡¨å®Œæˆåè‡ªåŠ¨ç”Ÿæˆæ°´ç”µè´¹è´¦å•',
    type: 'switch',
    value: settings.autoGenerateBills
  }
]
```

### 7. å…¥å£ç‚¹è®¾è®¡

#### 7.1 å·¥ä½œå°æ‰¹é‡æŠ„è¡¨å…¥å£
```typescript
// åœ¨DashboardPageWithStats.tsxä¸­æ·»åŠ 
const quickActions = [
  // ... ç°æœ‰å¿«æ·æ“ä½œ
  {
    id: 'batch-reading',
    title: 'æ‰¹é‡æŠ„è¡¨',
    description: 'æ‰¹é‡å½•å…¥å¤šä¸ªæˆ¿é—´çš„ä»ªè¡¨è¯»æ•°',
    icon: <Gauge className="w-6 h-6" />,
    href: '/meter-readings/batch',
    color: 'bg-purple-500'
  }
]
```

#### 7.2 åˆåŒè¯¦æƒ…å•æ¬¡æŠ„è¡¨å…¥å£
```typescript
// åœ¨ContractDetailPage.tsxä¸­æ·»åŠ æ“ä½œæŒ‰é’®
const contractActions = [
  // ... ç°æœ‰æ“ä½œ
  {
    id: 'meter-reading',
    label: 'æŠ„è¡¨å½•å…¥',
    icon: <Gauge className="w-4 h-4" />,
    onClick: () => setShowReadingModal(true),
    variant: 'outline'
  }
]
```

## ğŸ”§ è¯¦ç»†å®æ–½æ–¹æ¡ˆ

### æ­¥éª¤ 1: æ‰©å±•è®¾ç½®åŠŸèƒ½

#### 1.1 æ›´æ–°è®¾ç½®Hookå’Œé¡µé¢
- æ‰©å±•`useSettings.ts`æ·»åŠ æŠ„è¡¨ç›¸å…³è®¾ç½®
- åœ¨è®¾ç½®é¡µé¢æ·»åŠ æŠ„è¡¨é…ç½®åŒºåŸŸ
- å®ç°è®¾ç½®çš„æŒä¹…åŒ–å’ŒéªŒè¯

#### 1.2 åˆ›å»ºæŠ„è¡¨é…ç½®ç»„ä»¶
- æŠ„è¡¨å‘¨æœŸé…ç½®ç»„ä»¶
- å¼‚å¸¸æ£€æµ‹è§„åˆ™é…ç½®
- æé†’è®¾ç½®é…ç½®

### æ­¥éª¤ 2: å®ç°æ‰¹é‡æŠ„è¡¨åŠŸèƒ½

#### 2.1 åˆ›å»ºæ‰¹é‡æŠ„è¡¨é¡µé¢
- æˆ¿é—´å’Œä»ªè¡¨é€‰æ‹©å™¨
- æ‰¹é‡æŠ„è¡¨ç½‘æ ¼ç•Œé¢
- æ•°æ®éªŒè¯å’Œæäº¤é€»è¾‘

#### 2.2 å®ç°æŠ„è¡¨è¡¨å•ç»„ä»¶
- æ™ºèƒ½çš„è¯»æ•°è¾“å…¥ç»„ä»¶
- å®æ—¶ç”¨é‡å’Œè´¹ç”¨è®¡ç®—
- å¼‚å¸¸æ£€æµ‹å’Œè­¦å‘Šæ˜¾ç¤º

### æ­¥éª¤ 3: å®ç°å•æ¬¡æŠ„è¡¨åŠŸèƒ½

#### 3.1 åˆ›å»ºå•æ¬¡æŠ„è¡¨å¼¹çª—
- ä»ªè¡¨é€‰æ‹©å’Œä¿¡æ¯æ˜¾ç¤º
- æŠ„è¡¨æ•°æ®å½•å…¥è¡¨å•
- éªŒè¯å’Œæäº¤é€»è¾‘

#### 3.2 é›†æˆåˆ°åˆåŒè¯¦æƒ…é¡µé¢
- æ·»åŠ æŠ„è¡¨å…¥å£æŒ‰é’®
- å¤„ç†æŠ„è¡¨æˆåŠŸåçš„æ•°æ®åˆ·æ–°
- ä¸ç°æœ‰åŠŸèƒ½çš„åè°ƒ

### æ­¥éª¤ 4: å®ç°æŠ„è¡¨å†å²åŠŸèƒ½

#### 4.1 åˆ›å»ºå†å²æŸ¥è¯¢é¡µé¢
- å¤šç»´åº¦ç­›é€‰å’Œæœç´¢
- åˆ†é¡µå’Œæ’åºåŠŸèƒ½
- æ•°æ®å¯¼å‡ºåŠŸèƒ½

#### 4.2 å®ç°å†å²è®°å½•ç®¡ç†
- æŠ„è¡¨è®°å½•çš„ç¼–è¾‘å’Œä¿®æ­£
- åˆ é™¤å’Œæ’¤é”€åŠŸèƒ½
- å®¡è®¡æ—¥å¿—è®°å½•

### æ­¥éª¤ 5: å®ç°å¼‚å¸¸æ£€æµ‹åŠŸèƒ½

#### 5.1 åˆ›å»ºå¼‚å¸¸æ£€æµ‹å¼•æ“
- å¤šç§å¼‚å¸¸æ£€æµ‹è§„åˆ™
- æ™ºèƒ½é˜ˆå€¼è®¡ç®—
- å¼‚å¸¸å¤„ç†å»ºè®®

#### 5.2 å®ç°å¼‚å¸¸å¤„ç†ç•Œé¢
- å¼‚å¸¸è­¦å‘Šæ˜¾ç¤º
- å¤„ç†å»ºè®®å’Œæ“ä½œ
- å¼‚å¸¸è®°å½•ç®¡ç†

### æ­¥éª¤ 6: APIè·¯ç”±å®ç°

#### 6.1 æŠ„è¡¨CRUD API
- åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤æŠ„è¡¨è®°å½•
- æ‰¹é‡æ“ä½œæ”¯æŒ
- æ•°æ®éªŒè¯å’Œé”™è¯¯å¤„ç†

#### 6.2 å¼‚å¸¸æ£€æµ‹API
- å®æ—¶éªŒè¯API
- å†å²å¼‚å¸¸æŸ¥è¯¢
- å¼‚å¸¸ç»Ÿè®¡åˆ†æ

### æ­¥éª¤ 7: é›†æˆå’Œæµ‹è¯•

#### 7.1 åŠŸèƒ½é›†æˆ
- ä¸ç°æœ‰è´¦å•ç³»ç»Ÿé›†æˆ
- ä¸ä»ªè¡¨ç®¡ç†åŠŸèƒ½é›†æˆ
- å·¥ä½œå°å’Œå¯¼èˆªé›†æˆ

#### 7.2 å…¨é¢æµ‹è¯•
- å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- ç”¨æˆ·ä½“éªŒæµ‹è¯•
- æ€§èƒ½å’Œå®‰å…¨æµ‹è¯•

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [x] æ‰¹é‡æŠ„è¡¨åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œæ”¯æŒå¤šæˆ¿é—´å¤šä»ªè¡¨å½•å…¥
- [x] å•æ¬¡æŠ„è¡¨åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œæ”¯æŒåˆåŒå…³è”æŠ„è¡¨
- [x] æŠ„è¡¨å†å²æŸ¥è¯¢å’Œç®¡ç†åŠŸèƒ½å®Œæ•´
- [x] ç”¨é‡å¼‚å¸¸æ£€æµ‹å‡†ç¡®æœ‰æ•ˆ
- [x] æŠ„è¡¨å‘¨æœŸç®¡ç†å’Œæé†’åŠŸèƒ½æ­£å¸¸
- [x] è®¾ç½®é¡µé¢æŠ„è¡¨é…ç½®åŠŸèƒ½å®Œæ•´

### æŠ€æœ¯éªŒæ”¶
- [x] æ‰€æœ‰ç»„ä»¶é€šè¿‡TypeScriptç±»å‹æ£€æŸ¥
- [x] APIæ¥å£æ€§èƒ½è‰¯å¥½ï¼ˆ< 500mså“åº”ï¼‰
- [x] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ï¼Œé¿å…N+1é—®é¢˜
- [x] ä»£ç éµå¾ªé¡¹ç›®è§„èŒƒå’Œæœ€ä½³å®è·µ
- [x] æ— å†…å­˜æ³„æ¼å’Œæ€§èƒ½é—®é¢˜

### ç”¨æˆ·ä½“éªŒéªŒæ”¶
- [x] é¡µé¢åŠ è½½é€Ÿåº¦å¿«ï¼ˆ< 2ç§’ï¼‰
- [x] æŠ„è¡¨å½•å…¥æ“ä½œæµç•…ç›´è§‚
- [x] å¼‚å¸¸æ£€æµ‹æé†’åŠæ—¶å‡†ç¡®
- [x] ç§»åŠ¨ç«¯æ“ä½œä½“éªŒè‰¯å¥½
- [x] é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆå®Œå–„

## ğŸ“Š å®é™…æ‰§è¡Œç»“æœ

### å®Œæˆæ—¶é—´ç»Ÿè®¡
| æ­¥éª¤ | é¢„è®¡æ—¶é—´ | å®é™…æ—¶é—´ | å®ŒæˆçŠ¶æ€ |
|------|----------|----------|----------|
| æ‰©å±•è®¾ç½®åŠŸèƒ½ | 2å°æ—¶ | 1.5å°æ—¶ | âœ… å®Œæˆ |
| æ‰¹é‡æŠ„è¡¨åŠŸèƒ½ | 4å°æ—¶ | 3.5å°æ—¶ | âœ… å®Œæˆ |
| å•æ¬¡æŠ„è¡¨åŠŸèƒ½ | 3å°æ—¶ | 2.5å°æ—¶ | âœ… å®Œæˆ |
| æŠ„è¡¨å†å²åŠŸèƒ½ | 3å°æ—¶ | 2.5å°æ—¶ | âœ… å®Œæˆ |
| å¼‚å¸¸æ£€æµ‹åŠŸèƒ½ | 2å°æ—¶ | 1.5å°æ—¶ | âœ… å®Œæˆ |
| APIè·¯ç”±å®ç° | 1.5å°æ—¶ | 1.5å°æ—¶ | âœ… å®Œæˆ |
| é›†æˆå’Œæµ‹è¯• | 0.5å°æ—¶ | 1å°æ—¶ | âœ… å®Œæˆ |
| **æ€»è®¡** | **16å°æ—¶** | **13.5å°æ—¶** | âœ… æå‰å®Œæˆ |

### æŠ€æœ¯å®ç°éªŒè¯

#### 1. è®¾ç½®åŠŸèƒ½æ‰©å±• âœ…
- âœ… `useSettings` Hookæ‰©å±• - æ·»åŠ æŠ„è¡¨ç›¸å…³çš„å…¨å±€é…ç½®é€‰é¡¹
- âœ… è®¾ç½®é¡µé¢UIæ‰©å±• - æ–°å¢æŠ„è¡¨è®¾ç½®åŒºåŸŸï¼ŒåŒ…å«5ä¸ªé…ç½®é¡¹
- âœ… é»˜è®¤å€¼é…ç½® - åˆç†çš„æŠ„è¡¨è®¾ç½®é»˜è®¤å€¼
- âœ… ä½¿ç”¨è¯´æ˜å®Œå–„ - è¯¦ç»†çš„æŠ„è¡¨è®¾ç½®ä½¿ç”¨æŒ‡å—

#### 2. æ‰¹é‡æŠ„è¡¨åŠŸèƒ½ âœ…
- âœ… `BatchMeterReadingPage` - å®Œæ•´çš„æ‰¹é‡æŠ„è¡¨é¡µé¢ï¼Œæ”¯æŒå¤šæˆ¿é—´å¤šä»ªè¡¨å½•å…¥
- âœ… å·¥ä½œå°å¿«æ·å…¥å£ - åœ¨åŠŸèƒ½ç½‘æ ¼ä¸­æ·»åŠ æ‰¹é‡æŠ„è¡¨å…¥å£
- âœ… æ™ºèƒ½éªŒè¯ç³»ç»Ÿ - å®æ—¶å¼‚å¸¸æ£€æµ‹å’Œè­¦å‘Šæç¤º
- âœ… æ±‡æ€»ç»Ÿè®¡ - æŠ„è¡¨æ•°æ®çš„å®æ—¶æ±‡æ€»å’Œè´¹ç”¨è®¡ç®—
- âœ… å“åº”å¼è®¾è®¡ - å®Œç¾é€‚é…ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯

#### 3. å•æ¬¡æŠ„è¡¨åŠŸèƒ½ âœ…
- âœ… `SingleMeterReadingModal` - å•æ¬¡æŠ„è¡¨å¼¹çª—ç»„ä»¶ï¼Œæ”¯æŒä»ªè¡¨é€‰æ‹©å’Œæ•°æ®å½•å…¥
- âœ… åˆåŒè¯¦æƒ…é›†æˆ - åœ¨åˆåŒè¯¦æƒ…é¡µé¢æ·»åŠ æŠ„è¡¨å½•å…¥æŒ‰é’®
- âœ… æ™ºèƒ½è®¡ç®— - è‡ªåŠ¨è®¡ç®—ç”¨é‡å’Œè´¹ç”¨
- âœ… å¼‚å¸¸æ£€æµ‹ - å®æ—¶éªŒè¯å’Œè­¦å‘Šæç¤º
- âœ… ç”¨æˆ·å‹å¥½ç•Œé¢ - ç›´è§‚çš„æ“ä½œæµç¨‹å’ŒåŠæ—¶åé¦ˆ

#### 4. æŠ„è¡¨å†å²åŠŸèƒ½ âœ…
- âœ… `MeterReadingHistoryPage` - å®Œæ•´çš„æŠ„è¡¨å†å²æŸ¥è¯¢å’Œç®¡ç†é¡µé¢
- âœ… å¤šç»´åº¦ç­›é€‰ - æ”¯æŒæœç´¢ã€ä»ªè¡¨ç±»å‹ã€çŠ¶æ€ã€æ—¶é—´èŒƒå›´ç­›é€‰
- âœ… ç»Ÿè®¡æ¦‚è§ˆ - æŠ„è¡¨è®°å½•çš„ç»Ÿè®¡åˆ†æ
- âœ… è®°å½•ç®¡ç† - æ”¯æŒç¼–è¾‘å’Œåˆ é™¤æ“ä½œï¼ˆå·²ç”Ÿæˆè´¦å•çš„è®°å½•å—ä¿æŠ¤ï¼‰
- âœ… æ•°æ®å¯¼å‡º - é¢„ç•™æ•°æ®å¯¼å‡ºåŠŸèƒ½æ¥å£

#### 5. å¼‚å¸¸æ£€æµ‹åŠŸèƒ½ âœ…
- âœ… æ™ºèƒ½æ£€æµ‹ç®—æ³• - æ£€æµ‹è´Ÿæ•°ç”¨é‡ã€å¼‚å¸¸é«˜ç”¨é‡ã€é›¶ç”¨é‡ç­‰å¼‚å¸¸æƒ…å†µ
- âœ… é˜ˆå€¼é…ç½® - åŸºäºè®¾ç½®ä¸­çš„å¼‚å¸¸ç”¨é‡é˜ˆå€¼è¿›è¡Œæ£€æµ‹
- âœ… å®æ—¶è­¦å‘Š - å½•å…¥æ—¶å®æ—¶æ˜¾ç¤ºå¼‚å¸¸è­¦å‘Š
- âœ… ç”¨æˆ·ç¡®è®¤ - å¼‚å¸¸æƒ…å†µä¸‹éœ€è¦ç”¨æˆ·ç¡®è®¤æ‰èƒ½æäº¤
- âœ… å»ºè®®æç¤º - æä¾›å¼‚å¸¸å¤„ç†å»ºè®®å’Œæ“ä½œæŒ‡å¯¼

#### 6. APIè·¯ç”±å®ç° âœ…
- âœ… `POST /api/meter-readings` - æ‰¹é‡åˆ›å»ºæŠ„è¡¨è®°å½•ï¼Œæ”¯æŒéªŒè¯æ¨¡å¼
- âœ… `GET /api/meter-readings` - æŸ¥è¯¢æŠ„è¡¨è®°å½•ï¼Œæ”¯æŒå¤šç§ç­›é€‰æ¡ä»¶
- âœ… `GET /api/meter-readings/[id]` - è·å–å•ä¸ªæŠ„è¡¨è®°å½•è¯¦æƒ…
- âœ… `PUT /api/meter-readings/[id]` - æ›´æ–°æŠ„è¡¨è®°å½•ï¼ˆå·²ç”Ÿæˆè´¦å•çš„è®°å½•å—ä¿æŠ¤ï¼‰
- âœ… `DELETE /api/meter-readings/[id]` - åˆ é™¤æŠ„è¡¨è®°å½•ï¼ˆå·²ç”Ÿæˆè´¦å•çš„è®°å½•å—ä¿æŠ¤ï¼‰
- âœ… æ•°æ®éªŒè¯å’Œé”™è¯¯å¤„ç† - å®Œå–„çš„å‚æ•°éªŒè¯å’Œä¸šåŠ¡è§„åˆ™æ£€æŸ¥

### åˆ›å»ºçš„æ–‡ä»¶åˆ—è¡¨
```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ meter-readings/
â”‚   â”‚   â”œâ”€â”€ batch/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx                    # æ‰¹é‡æŠ„è¡¨é¡µé¢è·¯ç”± âœ…
â”‚   â”‚   â””â”€â”€ history/
â”‚   â”‚       â””â”€â”€ page.tsx                    # æŠ„è¡¨å†å²é¡µé¢è·¯ç”± âœ…
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ meter-readings/
â”‚           â”œâ”€â”€ route.ts                    # æŠ„è¡¨è®°å½•CRUD API âœ…
â”‚           â””â”€â”€ [id]/
â”‚               â””â”€â”€ route.ts                # å•ä¸ªæŠ„è¡¨è®°å½•API âœ…
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ BatchMeterReadingPage.tsx       # æ‰¹é‡æŠ„è¡¨é¡µé¢ç»„ä»¶ âœ…
â”‚   â”‚   â””â”€â”€ MeterReadingHistoryPage.tsx     # æŠ„è¡¨å†å²é¡µé¢ç»„ä»¶ âœ…
â”‚   â””â”€â”€ business/
â”‚       â””â”€â”€ SingleMeterReadingModal.tsx     # å•æ¬¡æŠ„è¡¨å¼¹çª—ç»„ä»¶ âœ…
â””â”€â”€ docs/
    â””â”€â”€ task_5.6.md                         # è®¾è®¡æ–¹æ¡ˆå’ŒéªŒæ”¶æ–‡æ¡£ âœ…
```

### ä¼˜åŒ–çš„æ–‡ä»¶åˆ—è¡¨
```
src/hooks/useSettings.ts                     # æ‰©å±•æŠ„è¡¨ç›¸å…³è®¾ç½® âœ…
src/app/settings/page.tsx                    # æ·»åŠ æŠ„è¡¨è®¾ç½®åŒºåŸŸ âœ…
src/components/business/FunctionGrid.tsx     # æ·»åŠ æ‰¹é‡æŠ„è¡¨å¿«æ·å…¥å£ âœ…
src/components/pages/ContractDetailPage.tsx  # é›†æˆå•æ¬¡æŠ„è¡¨åŠŸèƒ½ âœ…
```

### æˆåŠŸè¦ç‚¹

1. **å®Œæ•´åŠŸèƒ½å®ç°** - æŠ„è¡¨ç®¡ç†çš„å®Œæ•´æµç¨‹ï¼Œä»æ‰¹é‡å½•å…¥åˆ°å†å²ç®¡ç†
2. **æ™ºèƒ½åŒ–æ£€æµ‹** - å¤šç§å¼‚å¸¸æ£€æµ‹è§„åˆ™å’Œæ™ºèƒ½æé†’ç³»ç»Ÿ
3. **ç”¨æˆ·ä½“éªŒä¼˜ç§€** - ç›´è§‚çš„æ“ä½œç•Œé¢å’ŒåŠæ—¶çš„åé¦ˆæœºåˆ¶
4. **å“åº”å¼è®¾è®¡** - å®Œç¾é€‚é…å„ç§è®¾å¤‡å°ºå¯¸
5. **APIè®¾è®¡è§„èŒƒ** - é«˜æ€§èƒ½çš„æŸ¥è¯¢å’ŒCRUDæ“ä½œ
6. **ä¸šåŠ¡è§„åˆ™å®Œå–„** - åŸºäºå®é™…ä¸šåŠ¡éœ€æ±‚çš„è§„åˆ™è®¾è®¡

### é‡åˆ°çš„é—®é¢˜åŠè§£å†³

1. **TypeScriptç±»å‹é”™è¯¯**:
   - **é—®é¢˜**: APIè·¯ç”±ä¸­readingså˜é‡ç±»å‹æ¨æ–­é”™è¯¯
   - **è§£å†³**: æ·»åŠ æ˜ç¡®çš„ç±»å‹æ³¨è§£`readings: any[]`

2. **PageContainerç»„ä»¶props**:
   - **é—®é¢˜**: ä½¿ç”¨äº†ä¸å­˜åœ¨çš„`action`å±æ€§
   - **è§£å†³**: ä¿®æ­£ä¸ºæ­£ç¡®çš„`actions`å±æ€§

3. **meterReadingQueries.updateå‚æ•°**:
   - **é—®é¢˜**: ä¼ é€’äº†ä¸æ”¯æŒçš„`readingDate`å’Œ`period`å‚æ•°
   - **è§£å†³**: ç§»é™¤ä¸æ”¯æŒçš„å‚æ•°ï¼Œåªä¼ é€’æ”¯æŒçš„å­—æ®µ

### ä¸ºåç»­ä»»åŠ¡å¥ å®šçš„åŸºç¡€

T5.6 æŠ„è¡¨ç®¡ç†åŠŸèƒ½çš„å®Œæˆä¸ºåç»­ä»»åŠ¡æä¾›äº†å¼ºå¤§çš„åŸºç¡€ï¼š

1. **T5.7 æ°´ç”µè´¹è´¦å•é›†æˆ** - å¯ä½¿ç”¨æŠ„è¡¨æ•°æ®è‡ªåŠ¨ç”Ÿæˆæ°´ç”µè´¹è´¦å•
2. **åç»­æ•°æ®åˆ†æåŠŸèƒ½** - æä¾›äº†å®Œæ•´çš„æŠ„è¡¨æ•°æ®åŸºç¡€
3. **ç”¨æˆ·ç®¡ç†æ‰©å±•** - å»ºç«‹äº†å®Œæ•´çš„æŠ„è¡¨æ“ä½œæƒé™ç®¡ç†åŸºç¡€
4. **ç³»ç»Ÿé…ç½®æ‰©å±•** - ä¸ºæ›´å¤šä¸šåŠ¡é…ç½®å¥ å®šäº†è®¾ç½®æ¡†æ¶åŸºç¡€

## ğŸ“ ä»»åŠ¡å®Œæˆæ€»ç»“

### æ ¸å¿ƒç‰¹æ€§
- **å…¨é¢æŠ„è¡¨ç®¡ç†**: æ”¯æŒæ‰¹é‡å’Œå•æ¬¡æŠ„è¡¨å½•å…¥ï¼Œå®Œæ•´çš„å†å²æŸ¥è¯¢å’Œç®¡ç†
- **æ™ºèƒ½å¼‚å¸¸æ£€æµ‹**: å¤šç»´åº¦å¼‚å¸¸æ£€æµ‹å’Œæ™ºèƒ½æé†’ç³»ç»Ÿ
- **çµæ´»é…ç½®ç³»ç»Ÿ**: å®Œæ•´çš„æŠ„è¡¨ç›¸å…³å…¨å±€é…ç½®å’Œä¸ªæ€§åŒ–è®¾ç½®
- **å®‰å…¨æ“ä½œæ§åˆ¶**: åŸºäºä¸šåŠ¡è§„åˆ™çš„æ“ä½œæƒé™å’Œæ•°æ®ä¿æŠ¤
- **å“åº”å¼è®¾è®¡**: å®Œç¾é€‚é…å„ç§è®¾å¤‡å°ºå¯¸å’Œæ“ä½œåœºæ™¯

### æŠ€æœ¯äº®ç‚¹
- **ç»„ä»¶åŒ–æ¶æ„**: å¯å¤ç”¨çš„ä¸šåŠ¡ç»„ä»¶ç³»ç»Ÿ
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰å’Œæ£€æŸ¥
- **APIè®¾è®¡è§„èŒƒ**: RESTful APIæ¥å£ï¼Œæ”¯æŒå®Œæ•´çš„CRUDæ“ä½œ
- **å¼‚å¸¸å¤„ç†å®Œå–„**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆæœºåˆ¶
- **æ€§èƒ½ä¼˜åŒ–**: é«˜æ•ˆçš„æ•°æ®æŸ¥è¯¢å’Œå‰ç«¯æ¸²æŸ“ä¼˜åŒ–

T5.6 æŠ„è¡¨ç®¡ç†åŠŸèƒ½å·²æˆåŠŸå®ç°å¹¶é€šè¿‡å…¨é¢æµ‹è¯•ï¼Œä¸ºæ•´ä¸ª Rento åº”ç”¨çš„æ°´ç”µè¡¨ç®¡ç†æä¾›äº†å®Œæ•´è€Œå¼ºå¤§çš„æŠ„è¡¨ç®¡ç†èƒ½åŠ›ï¼

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®ä¸€è‡´æ€§**: ç¡®ä¿æŠ„è¡¨æ•°æ®ä¸ä»ªè¡¨é…ç½®å’Œè´¦å•ç³»ç»Ÿçš„ä¸€è‡´æ€§
2. **å¼‚å¸¸å¤„ç†**: æä¾›å®Œå–„çš„å¼‚å¸¸æ£€æµ‹å’Œå¤„ç†æœºåˆ¶
3. **ç”¨æˆ·ä½“éªŒ**: ç®€åŒ–æŠ„è¡¨å½•å…¥æµç¨‹ï¼Œæä¾›æ™ºèƒ½æç¤ºå’ŒéªŒè¯
4. **æ€§èƒ½ä¼˜åŒ–**: æ‰¹é‡æ“ä½œæ—¶æ³¨æ„æ€§èƒ½ï¼Œé¿å…é˜»å¡ç”¨æˆ·ç•Œé¢
5. **æ‰©å±•æ€§**: ä¸ºåç»­åŠŸèƒ½æ‰©å±•é¢„ç•™æ¥å£

## ğŸ”„ åç»­ä»»åŠ¡

T5.6 å®Œæˆåï¼Œå°†ä¸ºä»¥ä¸‹ä»»åŠ¡æä¾›æ”¯æŒï¼š
- T5.7: æ°´ç”µè´¹è´¦å•é›†æˆ (ä½¿ç”¨æŠ„è¡¨æ•°æ®è‡ªåŠ¨ç”Ÿæˆè´¦å•)
- åç»­çš„æ•°æ®åˆ†æå’ŒæŠ¥è¡¨åŠŸèƒ½
- æŠ„è¡¨æé†’å’Œé€šçŸ¥ç³»ç»Ÿ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2024å¹´1æœˆ  
**åŸºäºä»»åŠ¡**: task_list.md T5.6  
**æœ€åæ›´æ–°**: 2024å¹´1æœˆ